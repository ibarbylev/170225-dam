# Некоторые функции агрегации, используемые при группировке ($group)

В операторе $group используются агрегирующие функции, которые позволяют выполнять вычисления на основе данных в группе. 

| **Функция**        | **Описание**                                                  | **Пример использования**                         |
|---------------------|--------------------------------------------------------------|-------------------------------------------------|
| `$sum`             | Суммирует значения в группе.                                 | `{ $sum: "$price" }`                            |
| `$avg`             | Вычисляет среднее арифметическое значений в группе.          | `{ $avg: "$score" }`                            |
| `$min`             | Находит минимальное значение в группе.                      | `{ $min: "$age" }`                              |
| `$max`             | Находит максимальное значение в группе.                     | `{ $max: "$age" }`                              |
| `$first`           | Возвращает первый документ в группе.                        | `{ $first: "$name" }`                           |
| `$last`            | Возвращает последний документ в группе.                     | `{ $last: "$name" }`                            |
| `$push`            | Создаёт массив из всех значений в группе.                   | `{ $push: "$tags" }`                            |
| `$addToSet`        | Создаёт массив уникальных значений (без дублирования).       | `{ $addToSet: "$category" }`                    |
| `$count`           | Считает количество документов в группе (суммирует 1).       | `{ $sum: 1 }`                                   |
| `$mergeObjects`    | Объединяет несколько документов в один объект.              | `{ $mergeObjects: "$details" }`                 |
| `$stdDevPop`       | Вычисляет стандартное отклонение для всех значений (популяционное). | `{ $stdDevPop: "$values" }`           |
| `$stdDevSamp`      | Вычисляет стандартное отклонение (выборочное).              | `{ $stdDevSamp: "$values" }`                    |



*Пример: Группировка с вычислениями*
*Исходные данные*
```
[
  { "_id": 1, "category": "A", "price": 100 },
  { "_id": 2, "category": "A", "price": 200 },
  { "_id": 3, "category": "B", "price": 300 },
  { "_id": 4, "category": "B", "price": 400 }
]
```

*Запрос с `$group`*
```
db.collection.aggregate([
  {
    $group: {
      _id: "$category",             // Группировка по полю "category"
      totalPrice: { $sum: "$price" }, // Сумма цен в каждой группе
      avgPrice: { $avg: "$price" },  // Средняя цена в группе
      minPrice: { $min: "$price" },  // Минимальная цена
      maxPrice: { $max: "$price" },  // Максимальная цена
      count: { $sum: 1 }             // Количество документов
    }
  }
])
```

*Результат:*
```
[
  { "_id": "A", "totalPrice": 300, "avgPrice": 150, "minPrice": 100, "maxPrice": 200, "count": 2 },
  { "_id": "B", "totalPrice": 700, "avgPrice": 350, "minPrice": 300, "maxPrice": 400, "count": 2 }
]
```
