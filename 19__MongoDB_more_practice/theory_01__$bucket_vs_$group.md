# Сравнение группировок bucket и group
## 1. $bucket

### Назначение:
Группирует документы в фиксированные диапазоны (корзины). Используется для создания диапазонных группировок, например, разбиение по возрастам или ценам.

### Ключевые особенности:

- Требует указания границ диапазонов (boundaries).
- Каждый документ помещается в одну корзину, основываясь на значении поля.
- Можно задать специальную корзину для значений, которые не входят в указанные границы (default).
- Работает только с числовыми данными (или значениями, сравнимыми в порядке).

### Результаты группировки: 

В зависимости от того, какие агрегатные операции вы выполняете,  
в каждой группе могут быть подсчитаны такие показатели, как:

- Количество элементов в группе (`$sum`),
- Список всех значений, попавших в группу (`$push`),
- Список уникальных значений, попавших в группу (`$addToSet`),
- Среднее значение или другие статистики (`$avg`).

*Пример*:
```
{
  $bucket: {
    groupBy: "$price",  // Поле для группировки
    boundaries: [0, 18, 30, 50, 100, Infinity], // Границы корзин
    default: "other", // Корзина для значений вне границ
    output: {
      countDocs: { $sum: 1 },
      objectInfo: { 
        $push: {
          obj_name: "$name",
          obj_price: "$price"
        }
      },
      uniq_names: {$addToSet: "$name"},
      avg_price: {$avg: "$price" }
    }
  }
}
```
*Результат: Группы на основе диапазонов:*
```
    0-17
    18-29
    30-49
    50-99
    > 100
    other (для значений меньше 0)
```
(Возможно также использование ```-Infinity```, если минимальное отрицательное значение неизвестно)


## 2. $group

### Назначение:
Создает произвольные группы на основе значений поля или вычисляемого выражения. Это более гибкий инструмент для группировки.

### Ключевые особенности:

- Не требует диапазонов.
- Можно группировать по конкретным значениям, выражениям, вычисляемым ключам и даже множественным полям.
- Используется для сложных вычислений, таких как суммы, средние значения, массивы, объединения и т. д.

*Пример:*
```
{
  $group: {
    _id: "$city", // Группировка по значению поля "city"
    totalPopulation: { $sum: "$population" } // Суммирование значения поля "population"
  }
}
```
*Результат:*
```
    Каждое значение city становится ключом в результате, с соответствующей суммой population.
```
| Характеристика      | `$bucket`                            | `$group`                              |
|---------------------|--------------------------------------|---------------------------------------|
| **Назначение**      | Разбивает на фиксированные диапазоны | Группирует по значениям или выражениям |
| **Диапазоны**       | Требует явного указания границ        | Не требует границ                     |
| **Ключ группировки**| Значения автоматически попадают в диапазоны | Указывается явно через поле или выражение |
| **Гибкость**        | Менее гибкий, но удобен для разбиения на корзины | Максимальная гибкость                 |
| **Пример использования** | Разбиение возраста на категории   | Суммирование населения по городам     |


Когда использовать:

    $bucket: Когда нужно распределить данные по диапазонам (например, возраста, цен, уровней).
    $group: Для более сложных и гибких группировок с вычислениями.

