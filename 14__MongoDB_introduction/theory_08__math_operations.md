# Математические операции в MongoDB

В MongoDB для выполнения арифметических операций в запросах используется несколько операторов. Эти операторы применяются в агрегации, обычно в этапах типа `$project`, `$group`, `$addFields` и т. д. Вот основные арифметические операторы:

## 1. $add — сложение

Оператор `$add` выполняет сложение двух или более значений.

*Пример: Сложение значений полей price и tax*

```
db.collection.aggregate([
  {
    $project: {
      total: { $add: ["$price", "$tax"] }  // 
    }
  }
]);
```

## 2. $subtract — вычитание

Оператор `$subtract` выполняет вычитание одного значения из другого.

*Пример: Находим разницу между временем окончания и временем начала* 
*ВНИМАНИЕ: В JavaScript эта разница будет в миллисекундах!*

```
db.collection.aggregate([
  {
    $project: {
      difference: { $subtract: ["$stop_time", "$start_time"] } 
    }
  }
]);
```

## 3. $multiply — умножение

Оператор `$multiply` выполняет умножение двух или более значений.

*Пример: Умножение полей price и quantity*

```
db.collection.aggregate([
  {
    $project: {
      total_amount: { $multiply: ["$price", "$quantity"] }  
    }
  }
]);
```

## 4. $divide — деление

Оператор `$divide` выполняет деление одного значения на другое.


*Пример: Деление полей total_amount на quantity*

```
db.collection.aggregate([
  {
    $project: {
      price_per_unit: { $divide: ["$total_amount", "$quantity"] } 
    }
  }
]);
```

## 5. $mod — остаток от деления

Оператор $mod вычисляет остаток от деления одного значения на другое.

*Пример: Остаток от деления price на 5*

```db.collection.aggregate([
  {
    $project: {
      remainder: { $mod: ["$price", 5] }  
    }
  }
]);
```

## 6. $exp — экспоненциальная функция

Оператор `$exp` вычисляет экспоненту (e в степени x) для заданного значения.

*Пример: e в степени value*

```
db.collection.aggregate([
  {
    $project: {
      exp_value: { $exp: "$value" }  
    }
  }
]);
```

## 7. $ln — натуральный логарифм

Оператор `$ln` вычисляет натуральный логарифм заданного значения.

*Пример: Натуральный логарифм значения поля value*

```
db.collection.aggregate([
  {
    $project: {
      ln_value: { $ln: "$value" }  
    }
  }
]);
```

## 8. $sqrt — квадратный корень

Оператор `$sqrt` вычисляет квадратный корень из заданного числа.

*Пример: Квадратный корень из value*

```
db.collection.aggregate([
  {
    $project: {
      sqrt_value: { $sqrt: "$value" }  
    }
  }
]);
```

## 9. $abs — абсолютное значение

Оператор `$abs` вычисляет абсолютное значение числа.

*Пример: Абсолютное значение поля value*

```
db.collection.aggregate([
  {
    $project: {
      absolute_value: { $abs: "$value" } 
    }
  }
]);
```

## 10. $ceil — округление в большую сторону

Оператор `$ceil` округляет число до ближайшего целого в большую сторону.

*Пример: Округление value в большую сторону*

```
db.collection.aggregate([
  {
    $project: {
      ceil_value: { $ceil: "$value" }  
    }
  }
]);
```

## 11. $floor — округление в меньшую сторону

Оператор `$floor` округляет число до ближайшего целого в меньшую сторону.

*Пример: Округление value в меньшую сторону*

```
db.collection.aggregate([
  {
    $project: {
      floor_value: { $floor: "$value" }  
    }
  }
]);
```

## 12. $round — округление

Оператор `$round` округляет число до заданного числа знаков после запятой.

*Пример: Округление value до 2 знаков после запятой*

```
db.collection.aggregate([
  {
    $project: {
      rounded_value: { $round: ["$value", 2] } 
    }
  }
]);
```

## Примеры комбинирования арифметических операторов:

MongoDB позволяет комбинировать несколько арифметических операций в одном запросе. 

*Например, для вычисления налога на основе суммы и процента налога:*

```
db.collection.aggregate([
  {
    $project: {
      total_price: { 
        $add: [
          "$price", 
          { $multiply: ["$price", 0.1] }  
        ]
      }
    }
  }
]);
```

Эти операторы помогают производить вычисления в MongoDB на лету в процессе агрегации данных.
