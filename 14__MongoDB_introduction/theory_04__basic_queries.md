# Простые запросы в MongoDB Compass

## Аналог WHERE (фильтрация документов)

В случе пустого JSON `{ }` будут выведены все документы коллекции.

Для фильтрации необходимо в JSON-объекте `{ }` указать параметры фильтрации.  

Например, `{ age: { $gte: 18 } }` оставить только те документы, где возраст >= 18.

(смотрите [theory_07__logical_operations.md](theory_07__logical_operations.md))

##  Аналог SELECT

Поле `project` (или стадия `$project` в агрегации) позволяет выбирать для вывода нужные ключи коллекции.



### 1. Вывести все ключи (поля)

Пустой JSON `{ }` выводит документы полностью и является аналогом `SELECT *` в SQL
```
$project: { }
```

### 2. Указать поля (ключи) для вывода
```
$project: { age: 1, name: 1 }
```
В каждом документе останется только `age`, `name` и  `_id`.
(`_id` ВСЕГДА выводится по умолчанию, если ЯВНО не указано иное)
 

### 3. Запрет вывода `_id`

В этом случае надо ЯВНО указать `_id: 0`
```
$project: { age: 1, name: 1, _id: 0 }
```
В каждом документе останется только `age` и `name`

### 4. Переименование ключа (поля) (Аналог alias)
```
$project: { Возраст: "$age" }
```
Теперь значения ключа (поля) `age` будут выведены под именем `Возраст`

### 5. Вывод JSON вложений в одну строку

JSON объекты, указанные в `$project` сохраняют свой формат при выводе.
Например, 
```
person: {
    age: 25,
    name: "John"
}
```
будет выведен как `person` и ссылка, нажав на которую, откроются все данные (`age` и `name`).
Чтобы вывести возраст и имя в разных строках, необходимо 
 - указать полный путь к нужному полю через dot-notation;
 - этот путь необходимо взять в кавычки;
 - и в начале пути указать знак `$`:

```
$project: { Возраст: "$person.age", Имя: "$person.name" }
```
ВАЖНО:
Имя поля слева НЕ должно содержать dot-notation.
В противном случе никакого эффекта не будет.

### 6. Вывод _id в одну строку

Правило, рассмотренное выше, не распространяется на `_id`.
Если уникальный идентификатор должно быть строкой, а не JSON объектом,  
следует использовать `$toString`:
```
$project: { _id: { $toString: '$_id' } } 
```


##  Аналог ORDER BY (сортировка документов)

В поле сортировки необходимо указать:
 - имя поля
 - направление сортировки (`1` - по возрастанию, `-1` - по убыванию)
```
$sort: { age: -1 , name: 1 }
```
(сначала возраст по убыванию, затем имена по возрастанию)