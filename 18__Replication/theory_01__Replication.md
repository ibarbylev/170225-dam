# Репликация в MongoDB

Репликация в MongoDB направлена на обеспечение высокой доступности, отказоустойчивости и балансировки нагрузки. Существуют два основных вида репликации (хотя один из них уже устарел):

## 1. Replica Set (Набор реплик)

- **Статус:** 
    - Это современный и рекомендуемый метод репликации.

- **Состав:** 
    - **Первичный узел (Primary):** 
        - Один узел в наборе реплик выбирается как первичный, он принимает все операции записи. 
      
    - **Вторичные узлы (Secondary):** 
        - Эти узлы копируют данные с первичного узла. Они могут использоваться для операций чтения, тем самым распределяя нагрузку. 
    
    - Может включать **арбитров (Arbiters)** для обеспечения кворума.
  
        - **Кворум:** 
            - В контексте MongoDB, кворум означает минимальное количество узлов, необходимое для достижения консенсуса, когда требуется выбрать новый первичный узел после сбоя текущего первичного или при его недоступности. Кворум нужен для того, чтобы набор реплик мог продолжать функционировать и принимать операции записи.

        - **Арбитры (Arbiters):**

            - **Арбитры** — это специальные узлы в наборе реплик, которые не хранят данные. Их основная роль — участвовать в процессе выборов первичного узла.
            Они используются для обеспечения нечетного числа голосов в системе, что критически важно для работы кворума. Нечетное число голосов позволяет избежать ситуации, когда при четном количестве узлов может возникнуть "пат" при выборах (например, 2 из 4 узлов за один вариант, 2 за другой).
          
        - Преимущества арбитров:
            - Они не требуют значительных ресурсов (память, дисковое пространство), так как не хранят данные. 
          
            - Арбитр помогает сэкономить на стоимости инфраструктуры, так как он может работать на относительно дешёвом оборудовании или даже на виртуальной машине с ограниченными ресурсами.
 

- **Репликация может быть синхронной и асинхронной:**
    - **Асинхронная:** 
        - По умолчанию, вторичные узлы асинхронно копируют данные с первичного. Это означает, что в случае сбоя первичного, данные на вторичных могут быть неактуальными.
      
    - **Синхронная:** 
        - Возможно через использование параметра `w:majority` для записи, где операция считается завершенной только после подтверждения от большинства узлов (включая первичный). Это обеспечивает более высокую консистентность, но может снизить производительность.


## 2. Master-Slave Replication (Репликация Ведущий-Ведомый):

- **Статус:** 
    - Устарел и не поддерживается с версии MongoDB 4.0. 
  
- **Состав:** 
    - Один ведущий узел (**Master**) записывает данные, и один или несколько ведомых узлов (**Slaves**), которые копируют данные с ведущего. 
  
- **Репликация:** 
    - **Асинхронная:** 
        - Всегда была асинхронной. Ведомые узлы получали изменения после того, как они были применены на ведущем.

    - **Синхронная:** 
        - Не было встроенной поддержки для синхронной репликации; переключение на ведомый при сбое ведущего требовало ручного вмешательства.


## 3. Sharded Cluster (Шардированный кластер):

- **Статус:** 
    - Это современный и активно используемый метод для горизонтального масштабирования данных. 
  
- **Состав:** 
    - Состоит из шардов (shards). Каждый шард сам по себе является набором реплик (Replica Set). Это позволяет не только масштабировать данные, но и обеспечивает высокую доступность и отказоустойчивость для каждого шарда.
  
- **Репликация:** 
    - **Асинхронная:**
        - Внутри каждого шарда репликация происходит асинхронно, как в Replica Sets. Миграция данных между шардами также асинхронна.
      
    - **Синхронная:** 
        - Аналогично набору реплик, внутри каждого шарда (Replica Set) можно использовать `w:majority` для более надежной записи, но это применимо внутри каждого шарда, а не для кластера в целом.



| Характеристика                     | Replica Set                     | Master-Slave Replication       | Sharded Cluster              |
|------------------------------------|---------------------------------|---------------------------------|-------------------------------|
| **Автоматический выбор Primary**  | Да                              | Нет                            | Да                            |
| **Динамическая архитектура**      | Да                              | Нет                            | Да                            |
| **Устаревание**                   | Современный стандарт            | Устарел, не рекомендуется      | Современный стандарт          |
| **Высокая доступность**           | Поддерживается                  | Нет                            | Поддерживается                |
| **Масштабирование**               | Ограниченное                    | Ограниченное                   | Горизонтальное                |
  